# Sanity check
ifeq ($(wildcard $(HITD_HOME)/src/nemu/nemu-main.cpp),)
  $(error HITD_HOME=$(HITD_HOME) is not a HITD repo)
endif

CPUS = $(shell nproc)

ifeq ($(shell test $(CPUS) -gt 32; echo $$?), 0)
  # 如果本机CPU数目大于32，则为32
  JOBS := 32
else ifeq ($(shell test $(CPUS) -gt 1; echo $$?), 0)
  # 如果本机CPU数目大于1，则为本机CPU数目除以2
  JOBS := $(shell expr $(CPUS) / 2)
else
  # 否则为1
  JOBS := 1
endif

# Include variables and rules generated by menuconfig
-include $(HITD_HOME)/include/config/auto.conf
-include $(HITD_HOME)/include/config/auto.conf.cmd

remove_quote = $(patsubst "%",%,$(1))
GUEST_ISA ?= $(call remove_quote,$(CONFIG_ISA))

# Include rules for menuconfig
include $(HITD_HOME)/scripts/config.mk

# use verilator ar and cpp compile elf
include $(HITD_HOME)/scripts/cpp_to_elf.mk

perfall:
	python ./tools/perf_all.py